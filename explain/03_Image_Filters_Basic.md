# 기본 이미지 필터들 - Gaussian, Sharpen, Sobel

## 📋 개요
이 문서는 AI Fourcut 프로젝트의 기본 이미지 필터들(Gaussian, Sharpen, Sobel)의 원리와 구현을 상세히 분석합니다.

## 🔍 Gaussian Filter (가우시안 필터)

### **목적과 원리**
- **목적**: 이미지 블러링, 노이즈 제거
- **원리**: 가우시안 분포를 이용한 공간 필터링
- **효과**: 부드러운 이미지, 노이즈 감소

### **커널 구조**
```
가우시안 3×3 커널:
┌─────┬─────┬─────┐
│  1  │  2  │  1  │
├─────┼─────┼─────┤
│  2  │  4  │  2  │  × (1/16)
├─────┼─────┼─────┤
│  1  │  2  │  1  │
└─────┴─────┴─────┘
```

### **하드웨어 구현**

#### **라인 버퍼 구조**
```systemverilog
logic [15:0] line_even[0:IMG_WIDTH-1];  // 짝수 라인
logic [15:0] line_odd [0:IMG_WIDTH-1];  // 홀수 라인
```

#### **3×3 윈도우**
```systemverilog
logic [15:0] top_tap_0, top_tap_1, top_tap_2;  // 상단 라인
logic [15:0] mid_tap_0, mid_tap_1, mid_tap_2;  // 중간 라인
logic [15:0] cur_tap_0, cur_tap_1, cur_tap_2;  // 현재 라인
```

#### **커널 연산**
```systemverilog
// RGB 채널별 가우시안 연산
sumR = R5(top_tap_0) + (R5(top_tap_1) << 1) + R5(top_tap_2) +
       (R5(mid_tap_0) << 1) + (R5(mid_tap_1) << 2) + (R5(mid_tap_2) << 1) +
       R5(cur_tap_0) + (R5(cur_tap_1) << 1) + R5(cur_tap_2);

// 16으로 나누기 (>> 4)
outR = sumR >> 4;
```

### **특징**
- **메모리 효율성**: 2라인 버퍼만 사용
- **실시간 처리**: 파이프라인 구조
- **정밀도**: 고정소수점 연산

## 🔍 Sharpen Filter (샤프닝 필터)

### **목적과 원리**
- **목적**: 이미지 선명화, 엣지 강조
- **원리**: 라플라시안 연산자 기반
- **효과**: 선명한 이미지, 디테일 강조

### **커널 구조**
```
샤프닝 3×3 커널:
┌─────┬─────┬─────┐
│  0  │ -1  │  0  │
├─────┼─────┼─────┤
│ -1  │  5  │ -1  │
├─────┼─────┼─────┤
│  0  │ -1  │  0  │
└─────┴─────┴─────┘
```

### **구현 특징**
- **엣지 강조**: 중심 픽셀에 높은 가중치
- **노이즈 감소**: 주변 픽셀과의 차이 계산
- **선명도 향상**: 고주파 성분 강조

## 🔍 Sobel Filter (소벨 필터)

### **목적과 원리**
- **목적**: 엣지 검출, 윤곽선 추출
- **원리**: 1차 미분 연산자
- **효과**: 객체 경계 검출

### **커널 구조**

#### **Gx (수평 엣지)**
```
┌─────┬─────┬─────┐
│ -1  │  0  │  1  │
├─────┼─────┼─────┤
│ -2  │  0  │  2  │
├─────┼─────┼─────┤
│ -1  │  0  │  1  │
└─────┴─────┴─────┘
```

#### **Gy (수직 엣지)**
```
┌─────┬─────┬─────┐
│ -1  │ -2  │ -1  │
├─────┼─────┼─────┤
│  0  │  0  │  0  │
├─────┼─────┼─────┤
│  1  │  2  │  1  │
└─────┴─────┴─────┘
```

### **하드웨어 구현**

#### **그레이스케일 변환**
```systemverilog
// RGB565 → 8비트 그레이스케일
assign in_r = {wData_in[15:11], 3'b0};  // 8비트 확장
assign in_g = {wData_in[10:5], 2'b0};   // 8비트 확장
assign in_b = {wData_in[4:0], 3'b0};    // 8비트 확장

// 가중치 합 (ITU-R BT.709 표준)
gray <= ((in_r * 16'd77) + (in_g * 16'd150) + (in_b * 16'd29)) >> 8;
```

#### **소벨 연산**
```systemverilog
// Gx, Gy 계산
gx <= (p02 + (p12 << 1) + p22) - (p00 + (p10 << 1) + p20);
gy <= (p20 + (p21 << 1) + p22) - (p00 + (p01 << 1) + p02);

// 절댓값 합
mag <= (gx[11] ? -gx : gx) + (gy[11] ? -gy : gy);

// 임계값 처리
edge_bin <= (sobel_val >= THRESHOLD) ? 8'hFF : 8'h00;
```

### **특징**
- **이진화 출력**: 엣지/비엣지 구분
- **임계값 조정**: 민감도 제어 가능
- **실시간 처리**: 하드웨어 최적화

## ⚡ 성능 비교

| 필터 | 메모리 사용량 | 처리 지연 | 복잡도 | 용도 |
|------|---------------|-----------|--------|------|
| Gaussian | 2라인 버퍼 | 3클럭 | 중간 | 블러링 |
| Sharpen | 2라인 버퍼 | 3클럭 | 중간 | 선명화 |
| Sobel | 2라인 버퍼 | 4클럭 | 높음 | 엣지 검출 |

## 🔧 공통 설계 패턴

### **1. 라인 버퍼 구조**
```systemverilog
// 짝수/홀수 라인 버퍼
logic [15:0] line_even[0:IMG_WIDTH-1];
logic [15:0] line_odd [0:IMG_WIDTH-1];

// 라인 선택
if (y[0] == 1'b0) begin
    line_even[x] <= wData_in;  // 짝수 라인
end else begin
    line_odd[x] <= wData_in;    // 홀수 라인
end
```

### **2. 3×3 윈도우 관리**
```systemverilog
// 윈도우 슬라이딩
top_tap_0 <= top_tap_1;
top_tap_1 <= top_tap_2;
top_tap_2 <= top_rd;
```

### **3. 파이프라인 처리**
```systemverilog
// 지연 레지스터
logic [16:0] addr_d1, addr_d2, addr_d3;
logic we_d1, we_d2, we_d3;

// 파이프라인 정렬
wAddr_out <= addr_d3;
we_out <= we_d3;
```

## 🎯 학습 포인트

1. **공간 필터링**: 3×3 커널을 이용한 이미지 처리
2. **라인 버퍼**: 메모리 효율적인 스트리밍 처리
3. **파이프라인**: 실시간 처리 위한 지연 정렬
4. **고정소수점**: 하드웨어 친화적인 수치 연산
5. **모듈화**: 재사용 가능한 필터 구조

## 📝 다음 단계
- `04_Color_Filters.md`: 색상 필터들 (Warm, Cool, Cartoon)
- `05_Special_Filters.md`: 특수 필터들 (Ghost, Mirror, Graduation)
- `06_Sticker_Filter.md`: 스티커 필터 특별 분석
